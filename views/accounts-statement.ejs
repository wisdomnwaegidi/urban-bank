<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Account Statement</title>
    <link rel="stylesheet" href="/css/account-statement.css" />
  </head>
  <body>
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Account Statement</h1>
        <p class="account-info">
          Account Overview & Transaction History for <%= user.firstName %> <%=
          user.lastName %>
        </p>
      </div>

      <!-- Summary Cards -->
      <div class="summary-cards">
        <div class="summary-card credits">
          <div class="card-title">Total Credits</div>
          <div class="card-value positive">
            $<%= totalCredits ? totalCredits.toLocaleString() : "0.00" %>
          </div>
        </div>
        <div class="summary-card debits">
          <div class="card-title">Total Debits</div>
          <div class="card-value negative">
            $<%= totalDebits ? totalDebits.toLocaleString() : "0.00" %>
          </div>
        </div>
        <div class="summary-card balance">
          <div class="card-title">Net Balance</div>
          <div class="card-value neutral">
            $<%= balance ? balance.toLocaleString() : "0.00" %>
          </div>
        </div>
      </div>

      <!-- Monthly Summary -->
      <div class="statement-section monthly-summary">
        <div class="section-header">
          <h2 class="section-title">Monthly Account Summary</h2>
        </div>

        <% if (monthlySummary && Object.keys(monthlySummary).length > 0) { %> <%
        Object.keys(monthlySummary).forEach(monthKey => { const year =
        monthKey.split("-")[0]; const month = monthKey.split("-")[1]; const m =
        monthlySummary[monthKey]; const net = (m.credits || 0) - (m.debits ||
        0); %>
        <div class="monthly-row">
          <div class="month-info"><%= monthKey %></div>
          <div class="amounts">
            <div class="amount-item">
              <div class="amount-label">Credits</div>
              <div class="amount-value credit">
                $<%= (m.credits || 0).toLocaleString() %>
              </div>
            </div>
            <div class="amount-item">
              <div class="amount-label">Debits</div>
              <div class="amount-value">
                $<%= (m.debits || 0).toLocaleString() %>
              </div>
            </div>
            <div class="amount-item">
              <div class="amount-label">Recurring</div>
              <div
                class="amount-value <%= net >= 0 ? 'balance' : 'negative' %>"
              >
                $<%= net.toLocaleString() %>
              </div>
            </div>
            <a
              href="/accounts/statement/<%= year %>/<%= parseInt(month) %>"
              class="view-btn"
            >
              View
            </a>
          </div>
        </div>
        <% }) %> <% } else { %>
        <p>No monthly summaries available.</p>
        <% } %>
      </div>

      <!-- Date Filter -->
      <div class="statement-filters">
        <form method="GET" action="/accounts/report" class="filter-form">
          <div class="form-group">
            <label for="fromDate">From Date</label>
            <input type="date" id="fromDate" name="fromDate" required />
          </div>
          <div class="form-group">
            <label for="toDate">To Date</label>
            <input type="date" id="toDate" name="toDate" required />
          </div>
          <button type="submit" class="btn-primary">Generate Report</button>
        </form>
      </div>

      <!-- Pagination Controls -->
      <div class="pagination">
        <% if (currentPage > 1) { %>
        <a href="?page=<%= currentPage - 1 %>&limit=10" class="btn">Previous</a>
        <% } %>

        <span>Page <%= currentPage %> of <%= totalPages %></span>

        <% if (currentPage < totalPages) { %>
        <a href="?page=<%= currentPage + 1 %>&limit=10" class="btn">Next</a>
        <% } %>
      </div>

      <!-- Export Buttons -->
      <div class="export-buttons">
        <a href="/accounts/statement/export/pdf" class="btn-export pdf">
          <i class="fa fa-file-pdf"></i> Download PDF
        </a>
        <a href="/accounts/statement/export/excel" class="btn-export excel">
          <i class="fa fa-file-excel"></i> Download Excel
        </a>
      </div>

      <!-- Transaction Details -->
      <div class="statement-section">
        <div class="section-header">
          <h2 class="section-title">Recent Transaction Details</h2>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Debit</th>
                <th>Credit</th>
                <th>Balance</th>
              </tr>
            </thead>
            <tbody>
              <% if (transactions && transactions.length > 0) { %> <%
              transactions.forEach(tx => { %>
              <tr>
                <td>
                  <%= tx.date ? tx.date.toISOString().slice(0,10) : "--" %>
                </td>
                <td><%= tx.description %></td>
                <td class="amount debit">
                  <%= tx.debit > 0 ? "$" + tx.debit.toLocaleString() : "-" %>
                </td>
                <td class="amount credit">
                  <%= tx.credit > 0 ? "$" + tx.credit.toLocaleString() : "-" %>
                </td>
                <td>
                  <%= tx.balance ? "$" + tx.balance.toLocaleString() : "-" %>
                </td>
              </tr>
              <% }) %> <% } else { %>
              <tr>
                <td colspan="5">No transactions found</td>
              </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </body>
</html>
