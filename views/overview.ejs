<link rel="stylesheet" href="/css/overview.css" />

<!-- Welcome -->
<section class="welcome">
  <h1>
    Welcome 
    <% if (user && user.firstName && user.lastName) { %> 
      <%= user.firstName + " " + user.lastName %> 
    <% } else { %> 
      User 
    <% } %>
  </h1>
  <marquee behavior="" direction="">
    <div class="market-ticker">
      <% tickers.forEach(t => { %>
        <span><%= t.name %>: <%= t.value %></span>
      <% }) %>
    </div>
  </marquee>
</section>

<!-- Receive Money + Balances + Rates -->
<section class="grid three" aria-label="Balances and Rates">
  <article class="card">
    <h2>Receive Money</h2>
    <p>
      <strong>Account Name:</strong>
      <% if (user && user.firstName && user.lastName) { %> 
        <%= user.firstName + " " + user.lastName %> 
      <% } else { %> 
        User 
      <% } %>
    </p>
    <p>
      <strong>Account Number:</strong>
      <%= user && user.account ? user.account : "N/A" %>
    </p>
  </article>

  <article class="card">
    <h2>Your Balances:</h2>
    <p>
      <strong><%= user && user.currency ? user.currency : "Currency" %></strong>
    </p>
    <p>AVAILABLE BALANCE</p>
    <div class="balance">
      $<%= user && user.accountBalance ? user.accountBalance.toLocaleString() : "0.00" %>
    </div>
  </article>

  <article class="card">
    <h2>Our Rates</h2>
    <% indices.forEach(idx => { %>
      <p><%= idx.label %>: <%= idx.value %></p>
    <% }) %>
  </article>
</section>

<!-- Trading Indices -->
<section class="card" aria-label="Current Trading Indices">
  <h2>Current Trading Indices</h2>
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>EUR</th>
          <th>USD</th>
          <th>GBP</th>
          <th>CAD</th>
          <th>CNY</th>
        </tr>
      </thead>
      <tbody>
        <% if (currentIndices && currentIndices.length > 0) { %> 
          <% currentIndices.forEach(row => { %>
            <tr>
              <td><%= row.EUR %></td>
              <td><%= row.USD %></td>
              <td><%= row.GBP %></td>
              <td><%= row.CAD %></td>
              <td><%= row.CNY %></td>
            </tr>
          <% }) %> 
        <% } else { %>
          <tr>
            <td colspan="5">No indices available</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</section>

<!-- Recent Transactions -->
<section class="card" aria-label="Recent Transactions">
  <h2>Recent Transactions</h2>
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Account</th>
          <th>Amount</th>
          <th>Type</th>
          <th>Date</th>
          <th>Beneficiaries</th>
        </tr>
      </thead>
      <tbody>
        <% if (transactions && transactions.length > 0) { %>
          <% transactions.forEach(tx => { %>
            <tr>
              <!-- Account -->
              <td><%= user.account %></td>

              <!-- Amount -->
              <td>
                <% if (tx.debit > 0) { %>
                  -$<%= tx.debit.toLocaleString() %>
                <% } else if (tx.credit > 0) { %>
                  +$<%= tx.credit.toLocaleString() %>
                <% } else { %>
                  $0.00
                <% } %>
              </td>

              <!-- Type -->
              <td>
                <% if (tx.debit > 0) { %>
                  <span class="badge badge-danger">Debit</span>
                <% } else if (tx.credit > 0) { %>
                  <span class="badge badge-success">Credit</span>
                <% } else { %>
                  <span class="badge">N/A</span>
                <% } %>
              </td>

              <!-- Date -->
              <td><%= new Date(tx.date).toLocaleString() %></td>

              <!-- Beneficiaries -->
              <td>
                <% if (tx.type === "International" && tx.beneficiaryName) { %>
                  <%= tx.beneficiaryName %>
                  <% if (tx.beneficiaryBank) { %>(<%= tx.beneficiaryBank %>)<% } %>
                <% } else if (tx.type === "Local" && tx.localBeneficiaryName) { %>
                  <%= tx.localBeneficiaryName %>
                  <% if (tx.localBeneficiaryBank) { %>(<%= tx.localBeneficiaryBank %>)<% } %>
                <% } else if (tx.type === "Mobile Transfer" && tx.phoneNumber) { %>
                  <%= tx.mobileBeneficiaryName ? tx.mobileBeneficiaryName + " - " : "" %>
                  Mobile: <%= tx.phoneNumber %>
                <% } else { %>
                  N/A
                <% } %>
              </td>
            </tr>
          <% }) %>
        <% } else { %>
          <tr>
            <td colspan="5">No recent transactions</td>
          </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</section>
