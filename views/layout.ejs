<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>
      <%= typeof title !== 'undefined' ? title + ' - ' : '' %>Banking Dashboard
    </title>
    <link rel="icon" href="/favicon/five-icon.png" type="image/gif" />

    <!-- Icons + Fonts -->
    <link href="/css/font-awesome.min.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;600;700&family=Urbanist:wght@500;700&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="/css/layout.css" />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body
    data-theme="<%= user && user.settings ? user.settings.theme : 'light' %>"
    data-user-id="<%= user._id %>"
  >
    <!-- Sidebar -->
    <aside class="sidebar" aria-label="Primary">
      <div class="brand">
        <a href="/" class="brand__link" aria-label="Homepage">
          <span class="brand__name">Union Ledger</span>
        </a>
      </div>

      <nav class="side-nav">
        <ul>
          <li>
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'overview' ? 'active' : '' %>"
              href="/overview"
              id="overview"
              ><i class="fa fa-home"></i><span>Overview</span></a
            >
          </li>
          <li class="has-submenu">
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'accounts' ? 'active' : '' %>"
              href="#"
              id="accounts"
            >
              <i class="fa fa-money"></i><span>Accounts</span>
              <i class="fa fa-angle-down submenu-arrow"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="/profile" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Profile
                </a>
              </li>
              <li>
                <a href="/accounts/kyc" class="submenu-link">
                  <i class="fa fa-angle-right"></i> KYC
                </a>
              </li>
              <li>
                <a href="/accounts/statement" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Statement
                </a>
              </li>
            </ul>
          </li>
          <li>
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'cards' ? 'active' : '' %>"
              href="/cards"
              id="cards"
              ><i class="fa fa-credit-card"></i><span>Cards</span></a
            >
          </li>
          <% if (user && user.role === 'admin') { %>
          <li>
            <a
              href="/admin/support"
              class="nav-link <%= typeof active !== 'undefined' && active === 'support' ? 'active' : '' %>"
              >Support Tickets</a
            >
          </li>
          <% } %>
          <li class="has-submenu">
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'transfers' ? 'active' : '' %>"
              href="#"
              id="transfers"
            >
              <i class="fa fa-exchange"></i><span>Transfers</span>
              <i class="fa fa-angle-down submenu-arrow"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="/transfers/local" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Local
                </a>
              </li>
              <li>
                <a href="/transfers/international" class="submenu-link">
                  <i class="fa fa-angle-right"></i> International
                </a>
              </li>
              <li>
                <a href="/transfers/mobile-transfer" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Mobile transfer
                </a>
              </li>
              <li>
                <a href="/transfers/history" class="submenu-link">
                  <i class="fa fa-angle-right"></i> History
                </a>
              </li>
            </ul>
          </li>
          <li class="has-submenu">
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'loan' ? 'active' : '' %>"
              href="#"
              id="loan"
            >
              <i class="fa fa-file-text-o"></i><span>Loan</span>
              <i class="fa fa-angle-down submenu-arrow"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="/loan/application" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Application
                </a>
              </li>
              <li>
                <a href="/loan/status" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Status
                </a>
              </li>
            </ul>
          </li>
          <li>
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'analytics' ? 'active' : '' %>"
              href="/analytics"
              id="analytics"
              ><i class="fa fa-line-chart"></i><span>Analytics</span></a
            >
          </li>
          <li class="has-submenu">
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'security' ? 'active' : '' %>"
              href="#"
              id="security"
            >
              <i class="fa fa-shield"></i><span>Security</span>
              <i class="fa fa-angle-down submenu-arrow"></i>
            </a>
            <ul class="submenu">
              <li>
                <a href="/security/password" class="submenu-link">
                  <i class="fa fa-angle-right"></i> Password
                </a>
              </li>
              <li>
                <a href="/security/pin" class="submenu-link">
                  <i class="fa fa-angle-right"></i> PIN
                </a>
              </li>
            </ul>
          </li>
          <li>
            <a
              class="nav-link <%= typeof active !== 'undefined' && active === 'settings' ? 'active' : '' %>"
              href="/settings"
              id="settings"
              ><i class="fa fa-cog"></i><span>Settings</span></a
            >
          </li>
        </ul>

        <div class="side-foot">
          <button class="btn btn-outline" id="openSupport">
            <i class="fa fa-life-ring"></i> Support
          </button>
        </div>
      </nav>
    </aside>

    <!-- App container -->
    <div class="app">
      <!-- Topbar -->
      <header class="topbar" aria-label="Secondary">
        <button class="icon-btn" id="menuToggle" aria-label="Toggle menu">
          <i class="fa fa-bars"></i>
        </button>

        <form class="search" role="search" aria-label="Search transactions">
          <input
            type="search"
            placeholder="Search transactions, payees, categories…"
            aria-label="Search"
            id="globalSearch"
          />
          <button class="icon-btn" type="submit" aria-label="Search">
            <i class="fa fa-search"></i>
          </button>
        </form>

        <div class="topbar__right">
          <!-- notification icon -->
          <div class="notif-wrapper" style="position: relative">
            <button class="icon-btn" aria-label="Notifications" id="notifyBtn">
              <i class="fa fa-bell-o"></i>
              <span
                id="notifBadge"
                style="
                  display: none;
                  position: absolute;
                  top: 4px;
                  right: 4px;
                  background: red;
                  color: white;
                  font-size: 11px;
                  font-weight: bold;
                  border-radius: 50%;
                  padding: 2px 6px;
                  line-height: 1;
                "
              ></span>
            </button>

            <!-- dropdown -->
            <div
              id="notifDropdown"
              class="notif-dropdown"
              style="display: none; position: absolute; right: 0; top: 50px"
            >
              <ul id="notifList"></ul>
              <button id="clearNotif" class="btn-small">Clear All</button>
            </div>
          </div>

          <!-- Profile button -->
          <div class="profile">
            <button
              class="profile__btn"
              id="profileBtn"
              aria-expanded="false"
              aria-haspopup="menu"
            >
              <% if (user && user.profilePicture) { %>
              <img
                src="/image/<%= user.profilePicture %>"
                alt="Profile"
                class="avatar"
                style="
                  width: 32px;
                  height: 32px;
                  border-radius: 50%;
                  object-fit: cover;
                "
              />
              <% } else { %>
              <span class="avatar" aria-hidden="true"></span>
              <% } %>
              <span class="profile__name" id="userName"
                ><% if (user && user.firstName) { %><%= user.firstName %><% }
                else { %>User<% } %></span
              >
              <i class="fa fa-angle-down" aria-hidden="true"></i>
            </button>
            <ul
              class="profile__menu"
              role="menu"
              aria-label="Profile menu"
              id="profileMenu"
            >
              <li role="menuitem"><a href="/profile">Edit Profile</a></li>
              <li role="menuitem"><a href="/settings">Settings</a></li>
              <li role="menuitem"><a href="/logout" id="logout">Logout</a></li>
            </ul>
          </div>
        </div>
      </header>

      <!-- Main -->
      <main class="content" id="content">
        <!-- Toast -->
        <%- include('partials/toast') %>

        <!-- Page content -->
        <%- body %>
      </main>

      <!-- Footer -->
      <footer class="footer">
        <p>© <span id="year"></span> Union Ledger Bank. All rights reserved.</p>
      </footer>
    </div>

    <!-- Support Modal -->
    <div class="modal" id="supportModal" aria-hidden="true">
      <div class="modal__overlay" id="modalOverlay"></div>
      <div
        class="modal__content"
        role="dialog"
        aria-modal="true"
        aria-labelledby="supportTitle"
      >
        <button class="modal__close" id="closeModal" aria-label="Close">
          &times;
        </button>
        <h2 id="supportTitle" class="support__title">Support Request</h2>
        <form id="supportForm" novalidate>
          <label for="issue">Describe your issue:</label>
          <textarea id="issue" name="issue" rows="5" required></textarea>

          <label for="email">Your email:</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="you@example.com"
            required
          />

          <button type="submit" class="btn btn-primary">Submit</button>
        </form>
      </div>
    </div>

    <!-- Notification container -->
    <div
      id="notifications"
      style="
        position: fixed;
        top: 70px;
        right: 20px;
        z-index: 9999;
        max-width: 320px;
      "
    ></div>

    <!-- Scripts -->
    <script src="/js/layout.js"></script>
    <script src="/js/support.js"></script>

    <!-- Socket.IO client -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/socket-client.js"></script>
  </body>
</html>
